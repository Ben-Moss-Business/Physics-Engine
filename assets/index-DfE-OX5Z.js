(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const u of o.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&n(u)}).observe(document,{childList:!0,subtree:!0});function i(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(s){if(s.ep)return;s.ep=!0;const o=i(s);fetch(s.href,o)}})();const c=document.getElementById("canvas"),l=c.getContext("2d"),a=[],g=[];let h,f,d,p,v=document.getElementById("grav").value,w=document.getElementById("elas").value,E=.05*v;class r{constructor(t,i){this.x=t,this.y=i}add(t){return new r(this.x+t.x,this.y+t.y)}subtr(t){return new r(this.x-t.x,this.y-t.y)}mag(){return Math.sqrt(this.x**2+this.y**2)}mult(t){return new r(this.x*t,this.y*t)}normal(){return new r(-this.y,this.x).unit()}unit(){return this.mag()===0?new r(0,0):new r(this.x/this.mag(),this.y/this.mag())}drawVec(t,i,n,s){l.beginPath(),l.moveTo(t,i),l.lineTo(t+this.x*n,i+this.y*n),l.strokeStyle=s,l.stroke(),l.closePath()}static dot(t,i){return t.x*i.x+t.y*i.y}}class P{constructor(t,i,n,s){this.pos=new r(t,i),this.r=n,this.m=s,this.m===0?this.inv_m=0:this.inv_m=1/this.m,this.elasticity=1,this.vel=new r(0,0),this.acc=new r(0,0),this.acceleration=1,this.player=!1,a.push(this)}drawBall(){l.beginPath(),l.arc(this.pos.x,this.pos.y,this.r,0,2*Math.PI),l.strokeStyle="black",l.stroke(),l.fillStyle="green",l.fill(),l.closePath()}display(){l.font="10px sans-serif",this.vel.drawVec(this.pos.x,this.pos.y,10,"green"),l.fillStyle="black",l.fillText("m = "+this.m,this.pos.x-10,this.pos.y-5),l.fillText("e = "+this.elasticity,this.pos.x-10,this.pos.y+5)}reposition(){this.acc=this.acc.unit().mult(this.acceleration),this.vel=this.vel.add(this.acc),this.vel=this.vel.mult(1-E),this.pos=this.pos.add(this.vel)}}class y{constructor(t,i,n,s){this.start=new r(t,i),this.end=new r(n,s),g.push(this)}drawWall(){l.beginPath(),l.moveTo(this.start.x,this.start.y),l.lineTo(this.end.x,this.end.y),l.strokeStyle="green",l.stroke(),l.closePath()}wallUnit(){return this.end.subtr(this.start).unit()}}function T(e){c.addEventListener("keydown",function(t){["ArrowLeft","ArrowRight","ArrowUp","ArrowDown"].includes(t.key)&&t.preventDefault(),t.keyCode===37&&(h=!0),t.keyCode===38&&(f=!0),t.keyCode===39&&(d=!0),t.keyCode===40&&(p=!0)}),c.addEventListener("keyup",function(t){t.keyCode===37&&(h=!1),t.keyCode===38&&(f=!1),t.keyCode===39&&(d=!1),t.keyCode===40&&(p=!1)}),h&&(e.acc.x=-e.acceleration),f&&(e.acc.y=-e.acceleration),d&&(e.acc.x=e.acceleration),p&&(e.acc.y=e.acceleration),!h&&!d&&(e.acc.x=0),!f&&!p&&(e.acc.y=0)}function B(e,t){let i=10**t;return Math.round(e*i)/i}function m(e,t){return Math.floor(Math.random()*(t-e+1))+e}function _(e,t){let i=t.start.subtr(e.pos);if(r.dot(t.wallUnit(),i)>0)return t.start;let n=e.pos.subtr(t.end);if(r.dot(t.wallUnit(),n)>0)return t.end;let s=r.dot(t.wallUnit(),i),o=t.wallUnit().mult(s);return t.start.subtr(o)}function C(e,t){return e.r+t.r>=t.pos.subtr(e.pos).mag()}function W(e,t){if(_(e,t).subtr(e.pos).mag()<=e.r)return!0}function A(e,t){let i=e.pos.subtr(t.pos),n=e.r+t.r-i.mag(),s=i.unit().mult(n/(e.inv_m+t.inv_m));e.pos=e.pos.add(s.mult(e.inv_m)),t.pos=t.pos.add(s.mult(-t.inv_m))}function I(e,t){let i=e.pos.subtr(_(e,t));e.pos=e.pos.add(i.unit().mult(e.r-i.mag()))}function S(e,t){let i=e.pos.subtr(t.pos).unit(),n=e.vel.subtr(t.vel),s=r.dot(n,i),L=(-s*Math.min(e.elasticity,t.elasticity)-s)/(e.inv_m+t.inv_m),x=i.mult(L);e.vel=e.vel.add(x.mult(e.inv_m)),t.vel=t.vel.add(x.mult(-t.inv_m))}function M(e,t){let i=e.pos.subtr(_(e,t)).unit(),n=r.dot(e.vel,i),s=-n*e.elasticity,o=n-s;e.vel=e.vel.add(i.mult(-o))}function O(){let e=0;a.forEach(t=>{let i=t.vel.mag();e+=.5*t.m*i*i}),l.font="22px sans-serif",l.fillStyle="green",l.textAlign="left",l.fillText("Kinetic Energy: "+B(e,2)+" J",10,c.height-10)}function k(e){v=document.getElementById("grav").value,w=document.getElementById("elas").value,E=.05*v,l.clearRect(0,0,c.clientWidth,c.clientHeight),a.forEach((t,i)=>{let n=parseFloat(w);(isNaN(n)||n<0||n>1)&&(n=1),t.elasticity=n,t.drawBall(),t.player&&T(t),g.forEach(s=>{W(a[i],s)&&(I(a[i],s),M(a[i],s))});for(let s=i+1;s<a.length;s++)C(a[i],a[s])&&(A(a[i],a[s]),S(a[i],a[s]));t.display(),t.reposition()}),g.forEach(t=>{t.drawWall()}),O(),requestAnimationFrame(k)}for(let e=0;e<10;e++){let t=new P(m(100,500),m(50,400),m(20,50),m(.1,10));t.elasticity=1*w}new y(0,0,c.clientWidth,0);new y(c.clientWidth,0,c.clientWidth,c.clientHeight);new y(c.clientWidth,c.clientHeight,0,c.clientHeight);new y(0,c.clientHeight,0,0);a[0].player=!0;requestAnimationFrame(k);
